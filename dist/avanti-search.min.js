/*!
 * Avanti Search - v2.0.5 - 2017-10-31
 * https://github.com/avanti/avantisearch
 * Licensed MIT
 */
function goToTopPage(){}!function($){window.AvantiSearch={init:function(t,e){var o=this;o.options=$.extend(o.getDefaultOptions(),e),o.options.$result=t,o.start(),o.bind()},start:function(){var t=this;t.request=t._setRequest(),t._concatRequest(),t._setPaginationInfo(),t.options.pagination&&t._setPaginationWrap(),t.checkAndStart(),t._createButtons()},_createButtons:function(){var t=this;$(".resultItemsWrapper div[id^=ResultItems]").before('<button class="'+t.options.classLoadLess+" "+t.options.classLoadBtnHide+'">'+t.options.textLoadLess+"</button>").after('<button class="'+t.options.classLoadMore+'">'+t.options.textLoadMore+"</button>")},_setPaginationWrap:function(){var t=this,e=$("<div />",{class:t.options.classPagination});t.options.$resultItemsWrapper.append(e)},checkAndStart:function(){var t=this;t._checkRequestWithCookie()?t.startWithCookie():t.startWithoutCookie(),t.options.$result.trigger("avantisearch.init",[t.options,t.request])},_checkRequestWithCookie:function(){var t=this;if("undefined"==typeof Cookies)throw new Error("You need install this plugin https://github.com/js-cookie/js-cookie");var e=parseInt(window.location.hash.substr(1)),o=Cookies.get(t.options.cookieName);if(void 0===o)return!1;var a=JSON.parse(o),n=$.extend({},t.request);return!isNaN(e)&&void 0!==a&&JSON.stringify(n)!==o&&n.path===a.path},startWithCookie:function(){var t=this;t._setParamsFromCookie(),t._applyCookieParams(),t._getTotalItems(function(e){t.options.totalItems=parseInt(e),t.options.$totalItems.text(e),t.options.totalPages=t._getTotalPages(),t._checkAndLoadWithCookie()})},_checkAndLoadWithCookie:function(){var t=this,e=t.request.query.PageNumber,o=t.options.totalPages;if(t.options.$result.trigger("avantisearch.initWithCookie",[t.options,t.request]),t.options.pagination)return t._startPagination(),t.load("html",e,function(){t._showItems(e)}),!1;e===o&&1!==e?(t._showButton(t.options.classLoadLess),t._hideButton(t.options.classLoadMore),t.load("html",e,function(){t._showItems(e),t.load("prepend",e-1)})):1===e?t._startFirst(e,1!==o):e>1&&(t._showButton(t.options.classLoadMore),t._showButton(t.options.classLoadLess),t.load("html",e,function(){t._setUrlHash(e),t._showItems(e),t.load("append",e+1,function(){t.load("prepend",e-1,function(){t.request.query.PageNumber=e,t._concatRequest(),t._saveCookie()})})}))},_startFirst:function(t,e,o){var a=this;void 0===e&&(e=!0),!0===a.options.pagination&&(e=!1),a._hideButton(a.options.classLoadLess),a.load("html",t,function(){a._showItems(t),a._saveCookie(),e?a.load("append",t+1,function(){a._showButton(a.options.classLoadMore),void 0!==o&&o()}):(a._hideButton(a.options.classLoadMore),void 0!==o&&o())})},startWithoutCookie:function(){var t=this;return t._checkDefaultParams()?(t._setDefaultParams(),void t._startFirst(1,!0)):(t.options.$result.find("> div > ul > li").attr("page",1).removeClass("last first"),t._setUrlHash(1),t._saveCookie(),1===t.options.totalPages?(t._hideButton(t.options.classLoadMore),t._disableButton(t.options.classLoadMore),!1):t.options.pagination?(t._startPagination(),!1):void t.load("append",2))},_startPagination:function(){var t=this;t._hideButton(t.options.classLoadMore),t._disableButton(t.options.classLoadMore),t._hideButton(t.options.classLoadLess),t._disableButton(t.options.classLoadLess),t._createPagination(),t.bindPagination()},_clearPagination:function(){this.options.$pagination.html("")},load:function(t,e,o){var a=this;a.request.query.PageNumber=e,a._concatRequest(),"function"==typeof o?a._search(t,o):a._search(t)},_search:function(t,e,o){var a=this;a.options.$result.trigger("avantisearch.beforeSearch",[a.options,a.request]),void 0===o&&(o=0),$.ajax({url:a.request.url,type:"GET"}).then(function(n){var s=a.options.$result.find("> div > ul"),i=$(n).find("ul");i.find(".last, .first").removeClass("last first"),i.find(".helperComplement").remove();var r=i.find("li");r.attr("page",a.request.query.PageNumber),r.addClass(a.options.classItemPreLoad);var u=i.html()||"";s[t](u),a.options.$result.is(":hidden")&&a.options.$result.show(),a.options.$result.trigger("avantisearch.afterSearch",[a.options,a.request]),o=0,"function"==typeof e&&e(a)},function(n){throw 500===n.status&&o<a.options.attempts&&(o++,a._search(t,e,o)),new Error("Error on get page",n)})},_setParamsFromCookie:function(){var t=this,e=Cookies.get(t.options.cookieName);t.request=JSON.parse(e)},_applyCookieParams:function(){var t=this;t._setOrder(),t._setFilters()},_setOrder:function(){var t=this;t.options.$selectOrder.val(t.request.O)},_setFilters:function(t){var e=this,t=e.request.query.fq;for(var o in t){var a=t[o];if("function"==typeof a)return!0;var n=e.options.$filters.find('input[rel="fq='+a+'"]');n.length&&n.attr("checked","checked").parent().addClass(e.options.classFilterActive)}},_checkDefaultParams:function(){var t=this;return!!Object.keys(t.options.defaultParams).length},_setDefaultParams:function(){var t=this;t.request=$.extend(!0,t.request,t.options.defaultParams)},_setUrlHash:function(t){var e=this,o=void 0!==t?t:e.request.query.PageNumber;window.location.hash=o},_showItems:function(t){var e=this;e.options.$result.trigger("avantisearch.beforeShowItems",[e.options,e.request,t]),e.options.$result.find("."+e.options.classItemPreLoad+'[page="'+t+'"]').removeClass(e.options.classItemPreLoad),e.options.$result.trigger("avantisearch.afterShowItems",[e.options,e.request,t])},_enableButton:function(t){$("."+t).removeAttr("disabled")},_disableButton:function(t){$("."+t).attr("disabled","disabled")},_hideButton:function(t){var e=this;$("."+t).addClass(e.options.classLoadBtnHide)},_showButton:function(t){var e=this;$("."+t).removeClass(e.options.classLoadBtnHide)},_getPageByType:function(type){var self=this,$items=self.options.$result.find("> div > ul > li"),method="last",operation="+";"prev"===type&&(method="first",operation="-");var page=Number($items[method]().attr("page"));return{showPage:page,nextPage:eval(page+operation+1)}},_concatRequest:function(){var t=this,e=t.request.query,o=t.request.route+"?",a=Object.keys(e).length-1,n=0;for(var s in e){if("fq"===s){var i=t._concatRequestFilter(e[s],s);o=o.concat(i)}else o=o.concat(s,"=",e[s]);n!==a&&(o=o.concat("&")),n++}t.request.url=o},_concatRequestFilter:function(t,e){for(var o="",a=0,n=t.length;a<n;a++)o=o.concat(e,"=",t[a]),a!==n-1&&(o=o.concat("&"));return o},_saveCookie:function(t){var e=this;void 0===t&&(t=JSON.parse(JSON.stringify(e.request)));var o=JSON.stringify(t);Cookies.set(e.options.cookieName,o)},_loadNext:function(t){var e=this;return!(t.nextPage<1||t.nextPage>e.options.totalPages)},_setPaginationInfo:function(){var t=this;t.options.totalItems=t._getTotalItems(),t.options.totalPages=t._getTotalPages()},_loadFirst:function(t){var e=this;e._getTotalItems(function(o){e.options.totalItems=parseInt(o),e.options.$totalItems.text(o),e.options.totalPages=e._getTotalPages(),e._startFirst(1,!(e.options.totalPages<1),t)})},_getTotalItems:function(t){var e=this;if("function"==typeof t){e._concatRequest();var o="/api/catalog_system/pub/products/search"+e.request.url.replace("/buscapagina","")+"&_from=0&_to=1";return $.ajax({url:o,type:"get"}).then(function(e,o,a){var n=a.getResponseHeader("resources"),s=parseInt(n.split("/")[1]);return t(s)}),!1}var a=/\D/g,n=e.options.$totalItems.text().replace(a,"");return parseInt(Math.ceil(n))},_getTotalPages:function(){var t=this,e=t.request.query.PS,o=t.options.totalItems;return Math.ceil(o/e)},_createPagination:function(){var t=this;t.options.$pagination=$("."+t.options.classPagination),t._createPaginationFirstButton(),t._createPaginationPrevButton(),t._createPaginationButtons(),t._createPaginationNextButton(),t._createPaginationLastButton()},_createPaginationFirstButton:function(){var t=this,e=$("<button />",{class:"pagination__button pagination__button--first",page:"1"}).text(t.options.textPaginationFirst);t.options.$pagination.append(e),1===t.request.query.PageNumber&&t._disablePaginationButton(e)},_createPaginationPrevButton:function(){var t=this,e=$("<button />",{class:"pagination__button pagination__button--prev",page:t.request.query.PageNumber-1}).text(t.options.textPaginationPrev);t.options.$pagination.append(e),1===t.request.query.PageNumber&&t._disablePaginationButton(e)},_createPaginationButtons:function(){for(var t=this,e=t.request.query.PageNumber-t.options.paginationRangeButtons;e<=t.request.query.PageNumber;e++)if(!(e<1||e===t.request.query.PageNumber)){o=$("<button />",{class:"pagination__button pagination__button--page",page:e}).text(e);t.options.$pagination.append(o)}o=$("<button />",{class:"pagination__button pagination__button--page pagination__button--disabled pagination__button--current",page:t.request.query.PageNumber,disabled:"disabled"}).text(t.request.query.PageNumber);t.options.$pagination.append(o);for(e=t.request.query.PageNumber+1;e<=t.request.query.PageNumber+t.options.paginationRangeButtons;e++)if(!(e>t._getTotalPages())){var o=$("<button />",{class:"pagination__button pagination__button--page",page:e}).text(e);t.options.$pagination.append(o)}},_createPaginationNextButton:function(){var t=this,e=$("<button />",{class:"pagination__button pagination__button--next",page:t.request.query.PageNumber+1}).text(t.options.textPaginationNext);t.options.$pagination.append(e),t.request.query.PageNumber===t._getTotalPages()&&t._disablePaginationButton(e)},_createPaginationLastButton:function(){var t=this,e=$("<button />",{class:"pagination__button pagination__button--last",page:t._getTotalPages()}).text(t.options.textPaginationLast);t.options.$pagination.append(e),t.request.query.PageNumber===t._getTotalPages()&&t._disablePaginationButton(e)},_disablePaginationButton:function(t){t.addClass("pagination__button--disabled").attr("disabled","disabled")},_setRequest:function(){var t=this,e=t._getRequestUrl();return t._splitRequestUrl(e)},_getRequestUrl:function(){var t=this.options.$script.html(),e=/\/buscapagina\?.+&PageNumber=/gi.exec(t)[0];return decodeURIComponent(e)},_splitRequestUrl:function(t){var e=t.split("?"),o=e[0];if(e.length>1){var a=e[1].split("#"),n=a[0],s=a[1],i={};return i.fq=[],n.replace(/([^=&]+)=([^&]*)/g,function(t,e,o){var a=decodeURIComponent(o),n=decodeURIComponent(e);"fq"===n?i[n].push(a):i[n]="PageNumber"===n&&""===o?1:a}),{route:o,query:i,hash:s,url:t,path:window.location.pathname+window.location.search}}return{route:o,url:t}},bind:function(){var t=this;t.bindLoadMoreAndLess(),t.bindOrder(),t.bindFilters()},bindLoadMoreAndLess:function(){var t=this;$("."+t.options.classLoadLess+", ."+t.options.classLoadMore).on("click",function(e){e.preventDefault();var o="next",a="append",n=t.options.classLoadMore;$(this).hasClass(t.options.classLoadLess)&&(o="prev",a="prepend",n=t.options.classLoadLess);var s=t._getPageByType(o),i=$.extend({},t.request);i.query.PageNumber=s.showPage,t._saveCookie(i),t._loadNext(s)?t.load(a,s.nextPage):t._hideButton(n),t._setUrlHash(s.showPage),t._showItems(s.showPage)})},bindOrder:function(){var t=this;"O"===t.options.$selectOrder.attr("id")&&t.options.$selectOrder.removeAttr("onchange").unbind("change").off("change"),t.options.$selectOrder.on("change",function(e){e.preventDefault();var o=$(this),a=o.val();t.options.$result.trigger("avantisearch.beforeChangeOrder",[t.options,t.request,o]),t._setUrlHash(1),t._changeOrder(a,function(){t.options.$result.trigger("avantisearch.afterChangeOrder",[t.options,t.request,o])})})},_changeOrder:function(t,e){var o=this;o.request.query.O=t,o._concatRequest(),o._setUrlHash(1),o._loadFirst(e)},bindFilters:function(){var t=this;t.options.$filters.on("click",function(e){if("LABEL"===e.target.tagName)return!0;var o=$(this),a=o.find("input"),n=a.is(":checked"),s=a.attr("rel");n?o.addClass(t.options.classFilterActive):o.removeClass(t.options.classFilterActive),t.options.$result.trigger("avantisearch.beforeFilter",[t.options,t.request,o]),t._refreshFilter(s,n,o)})},_refreshFilter:function(t,e,o){var a=this,n=function(t){var o=t.split("="),n=o[0],s=o[1];if(e)a.request.query[n].push(s);else{var i=a.request.query[n].indexOf(s);a.request.query[n].splice(i,1)}};"object"==typeof t?t.map(n):"string"==typeof t&&n(t),a._loadFirst(function(){a.options.$result.trigger("avantisearch.afterFilter",[a.options,a.request,o||null]),a._setUrlHash(1),a.options.pagination&&(a._clearPagination(),a._createPagination()),a.bindPagination()})},bindPagination:function(){var t=this;$("."+t.options.classPagination).find("button").on("click",function(e){e.preventDefault();var o=$(this),a=parseInt(o.attr("page"));t.options.$result.trigger("avantisearch.beforeChangePage",[t.options,t.request]),t.load("html",a,function(){t._setUrlHash(a),t._showItems(a),t.request.query.PageNumber=a,t._clearPagination(),t._startPagination(),t._concatRequest(),t._saveCookie(),t.options.$result.trigger("avantisearch.afterChangePage",[t.options,t.request])})})},getDefaultOptions:function(){return{$resultItemsWrapper:$(".resultItemsWrapper"),$script:$(".resultItemsWrapper").children("script"),$totalItems:$(".searchResultsTime:first .resultado-busca-numero .value"),$selectOrder:$("#O"),$filters:$(".search-multiple-navigator label"),classFilterActive:"filter--active",classItemPreLoad:"shelf-item--preload",classLoadBtnHide:"load-btn--hide",classLoadLess:"load-less",classLoadMore:"load-more",classPagination:"pagination",textLoadLess:"Load less",textLoadMore:"Load more",textPaginationFirst:"First",textPaginationPrev:"Prev",textPaginationNext:"Next",textPaginationLast:"Last",textEmptyResult:"No product found",pagination:!1,paginationRangeButtons:3,cookieName:"AvantiSearchQuery",defaultParams:{},attempts:1}}},$.fn.avantiSearch=function(t){var e=this;return AvantiSearch.init(e,t),e}}(jQuery);