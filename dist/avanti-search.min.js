/*!
 * Avanti Search - v2.0.5 - 2017-10-31
 * https://github.com/avanti/avantisearch
 * Licensed MIT
 */
function goToTopPage(){}!function($){window.AvantiSearch={init:function(t,e){this.options=$.extend(this.getDefaultOptions(),e),this.options.$result=t,this.start(),this.bind()},start:function(){this.request=this._setRequest(),this._concatRequest(),this._setPaginationInfo(),this.options.pagination&&this._setPaginationWrap(),this.checkAndStart(),this._createButtons()},_createButtons:function(){$(".resultItemsWrapper div[id^=ResultItems]").before('<button class="'+this.options.classLoadLess+" "+this.options.classLoadBtnHide+'">'+this.options.textLoadLess+"</button>").after('<button class="'+this.options.classLoadMore+'">'+this.options.textLoadMore+"</button>")},_setPaginationWrap:function(){var t=$("<div />",{class:this.options.classPagination});this.options.$resultItemsWrapper.append(t)},checkAndStart:function(){this._checkRequestWithCookie()?this.startWithCookie():this.startWithoutCookie(),this.options.$result.trigger("avantisearch.init",[this.options,this.request])},_checkRequestWithCookie:function(){if("undefined"==typeof Cookies)throw new Error("You need install this plugin https://github.com/js-cookie/js-cookie");var t=parseInt(window.location.hash.substr(1)),e=Cookies.get(this.options.cookieName);if(void 0===e)return!1;var s=JSON.parse(e),i=$.extend({},this.request);return!isNaN(t)&&void 0!==s&&JSON.stringify(i)!==e&&i.path===s.path},startWithCookie:function(){var t=this;t._setParamsFromCookie(),t._applyCookieParams(),t._getTotalItems(function(e){t.options.totalItems=parseInt(e),t.options.$totalItems.text(e),t.options.totalPages=t._getTotalPages(),t._checkAndLoadWithCookie()})},_checkAndLoadWithCookie:function(){var t=this,e=t.request.query.PageNumber,s=t.options.totalPages;if(t.options.$result.trigger("avantisearch.initWithCookie",[t.options,t.request]),t.options.pagination)return t._startPagination(),t.load("html",e,function(){t._showItems(e)}),!1;e===s&&1!==e?(t._showButton(t.options.classLoadLess),t._hideButton(t.options.classLoadMore),t.load("html",e,function(){t._showItems(e),t.load("prepend",e-1)})):1===e?t._startFirst(e,1!==s):e>1&&(t._showButton(t.options.classLoadMore),t._showButton(t.options.classLoadLess),t.load("html",e,function(){t._setUrlHash(e),t._showItems(e),t.load("append",e+1,function(){t.load("prepend",e-1,function(){t.request.query.PageNumber=e,t._concatRequest(),t._saveCookie()})})}))},_startFirst:function(t,e,s){var i=this;void 0===e&&(e=!0),!0===i.options.pagination&&(e=!1),i._hideButton(i.options.classLoadLess),i.load("html",t,function(){i._showItems(t),i._saveCookie(),e?i.load("append",t+1,function(){i._showButton(i.options.classLoadMore),void 0!==s&&s()}):(i._hideButton(i.options.classLoadMore),void 0!==s&&s())})},startWithoutCookie:function(){return this._checkDefaultParams()&&this._setDefaultParams(),this.options.$result.find("> div > ul > li").attr("page",1).removeClass("last first"),this._setUrlHash(1),this._saveCookie(),1===this.options.totalPages?(this._hideButton(this.options.classLoadMore),this._disableButton(this.options.classLoadMore),!1):this.options.pagination?(this._startPagination(),!1):void this.load("append",2)},_startPagination:function(){this._hideButton(this.options.classLoadMore),this._disableButton(this.options.classLoadMore),this._hideButton(this.options.classLoadLess),this._disableButton(this.options.classLoadLess),this._createPagination(),this.bindPagination()},_clearPagination:function(){this.options.$pagination.html("")},load:function(t,e,s){this.request.query.PageNumber=e,this._concatRequest(),"function"==typeof s?this._search(t,s):this._search(t)},_search:function(t,e,s){var i=this;i.options.$result.trigger("avantisearch.beforeSearch",[i.options,i.request]),void 0===s&&(s=0),$.ajax({url:i.request.url,type:"GET"}).then(function(o){var a=i.options.$result.find("> div > ul"),n=$(o).find("ul");n.find(".last, .first").removeClass("last first"),n.find(".helperComplement").remove();var r=n.find("li");r.attr("page",i.request.query.PageNumber),r.addClass(i.options.classItemPreLoad);var u=n.html()||"";a[t](u),i.options.$result.is(":hidden")&&i.options.$result.show(),i.options.$result.trigger("avantisearch.afterSearch",[i.options,i.request]),s=0,"function"==typeof e&&e(i)},function(o){throw 500===o.status&&s<i.options.attempts&&(s++,i._search(t,e,s)),new Error("Error on get page",o)})},_setParamsFromCookie:function(){var t=Cookies.get(this.options.cookieName);this.request=JSON.parse(t)},_applyCookieParams:function(){this._setOrder(),this._setFilters()},_setOrder:function(){this.options.$selectOrder.val(this.request.O)},_setFilters:function(t){t=this.request.query.fq;for(var e in t){var s=t[e];if("function"==typeof s)return!0;var i=this.options.$filters.find('input[rel="fq='+s+'"]');i.length&&i.attr("checked","checked").parent().addClass(this.options.classFilterActive)}},_checkDefaultParams:function(){return!!Object.keys(this.options.defaultParams).length},_setDefaultParams:function(){this.request=$.extend(!0,this.request,this.options.defaultParams)},_setUrlHash:function(t){var e=void 0!==t?t:this.request.query.PageNumber;window.location.hash=e},_showItems:function(t){this.options.$result.trigger("avantisearch.beforeShowItems",[this.options,this.request,t]),this.options.$result.find("."+this.options.classItemPreLoad+'[page="'+t+'"]').removeClass(this.options.classItemPreLoad),this.options.$result.trigger("avantisearch.afterShowItems",[this.options,this.request,t])},_enableButton:function(t){$("."+t).removeAttr("disabled")},_disableButton:function(t){$("."+t).attr("disabled","disabled")},_hideButton:function(t){$("."+t).addClass(this.options.classLoadBtnHide)},_showButton:function(t){$("."+t).removeClass(this.options.classLoadBtnHide)},_getPageByType:function(type){var self=this,$items=self.options.$result.find("> div > ul > li"),method="last",operation="+";"prev"===type&&(method="first",operation="-");var page=Number($items[method]().attr("page"));return{showPage:page,nextPage:eval(page+operation+1)}},_concatRequest:function(){var t=this.request.query,e=this.request.route+"?",s=Object.keys(t).length-1,i=0;for(var o in t){if("fq"===o){var a=this._concatRequestFilter(t[o],o);e=e.concat(a)}else e=e.concat(o,"=",t[o]);i!==s&&(e=e.concat("&")),i++}this.request.url=e},_concatRequestFilter:function(t,e){for(var s="",i=0,o=t.length;i<o;i++)s=s.concat(e,"=",t[i]),i!==o-1&&(s=s.concat("&"));return s},_saveCookie:function(t){void 0===t&&(t=JSON.parse(JSON.stringify(this.request)));var e=JSON.stringify(t);Cookies.set(this.options.cookieName,e)},_loadNext:function(t){return!(t.nextPage<1||t.nextPage>this.options.totalPages)},_setPaginationInfo:function(){this.options.totalItems=this._getTotalItems(),this.options.totalPages=this._getTotalPages()},_loadFirst:function(t){var e=this;e._getTotalItems(function(s){e.options.totalItems=parseInt(s),e.options.$totalItems.text(s),e.options.totalPages=e._getTotalPages(),e._startFirst(1,!(e.options.totalPages<1),t)})},_getTotalItems:function(t){if("function"==typeof t){this._concatRequest();var e="/api/catalog_system/pub/products/search"+this.request.url.replace("/buscapagina","")+"&_from=0&_to=1";return $.ajax({url:e,type:"get"}).then(function(e,s,i){var o=i.getResponseHeader("resources"),a=parseInt(o.split("/")[1]);return t(a)}),!1}var s=this.options.$totalItems.text().replace(/\D/g,"");return parseInt(Math.ceil(s))},_getTotalPages:function(){var t=this.request.query.PS,e=this.options.totalItems;return Math.ceil(e/t)},_createPagination:function(){this.options.$pagination=$("."+this.options.classPagination),this._createPaginationFirstButton(),this._createPaginationPrevButton(),this._createPaginationButtons(),this._createPaginationNextButton(),this._createPaginationLastButton()},_createPaginationFirstButton:function(){var t=$("<button />",{class:"pagination__button pagination__button--first",page:"1"}).text(this.options.textPaginationFirst);this.options.$pagination.append(t),1===this.request.query.PageNumber&&this._disablePaginationButton(t)},_createPaginationPrevButton:function(){var t=$("<button />",{class:"pagination__button pagination__button--prev",page:this.request.query.PageNumber-1}).text(this.options.textPaginationPrev);this.options.$pagination.append(t),1===this.request.query.PageNumber&&this._disablePaginationButton(t)},_createPaginationButtons:function(){for(t=this.request.query.PageNumber-this.options.paginationRangeButtons;t<=this.request.query.PageNumber;t++)if(!(t<1||t===this.request.query.PageNumber)){e=$("<button />",{class:"pagination__button pagination__button--page",page:t}).text(t);this.options.$pagination.append(e)}e=$("<button />",{class:"pagination__button pagination__button--page pagination__button--disabled pagination__button--current",page:this.request.query.PageNumber,disabled:"disabled"}).text(this.request.query.PageNumber);this.options.$pagination.append(e);for(var t=this.request.query.PageNumber+1;t<=this.request.query.PageNumber+this.options.paginationRangeButtons;t++)if(!(t>this._getTotalPages())){var e=$("<button />",{class:"pagination__button pagination__button--page",page:t}).text(t);this.options.$pagination.append(e)}},_createPaginationNextButton:function(){var t=$("<button />",{class:"pagination__button pagination__button--next",page:this.request.query.PageNumber+1}).text(this.options.textPaginationNext);this.options.$pagination.append(t),this.request.query.PageNumber===this._getTotalPages()&&this._disablePaginationButton(t)},_createPaginationLastButton:function(){var t=$("<button />",{class:"pagination__button pagination__button--last",page:this._getTotalPages()}).text(this.options.textPaginationLast);this.options.$pagination.append(t),this.request.query.PageNumber===this._getTotalPages()&&this._disablePaginationButton(t)},_disablePaginationButton:function(t){t.addClass("pagination__button--disabled").attr("disabled","disabled")},_setRequest:function(){var t=this._getRequestUrl();return this._splitRequestUrl(t)},_getRequestUrl:function(){var t=this.options.$script.html(),e=/\/buscapagina\?.+&PageNumber=/gi.exec(t)[0];return decodeURIComponent(e)},_splitRequestUrl:function(t){var e=t.split("?"),s=e[0];if(e.length>1){var i=e[1].split("#"),o=i[0],a=i[1],n={};return n.fq=[],o.replace(/([^=&]+)=([^&]*)/g,function(t,e,s){var i=decodeURIComponent(s),o=decodeURIComponent(e);"fq"===o?n[o].push(i):n[o]="PageNumber"===o&&""===s?1:i}),{route:s,query:n,hash:a,url:t,path:window.location.pathname+window.location.search}}return{route:s,url:t}},bind:function(){this.bindLoadMoreAndLess(),this.bindOrder(),this.bindFilters()},bindLoadMoreAndLess:function(){var t=this;$("."+t.options.classLoadLess+", ."+t.options.classLoadMore).on("click",function(e){e.preventDefault();var s="next",i="append",o=t.options.classLoadMore;$(this).hasClass(t.options.classLoadLess)&&(s="prev",i="prepend",o=t.options.classLoadLess);var a=t._getPageByType(s),n=$.extend({},t.request);n.query.PageNumber=a.showPage,t._saveCookie(n),t._loadNext(a)?t.load(i,a.nextPage):t._hideButton(o),t._setUrlHash(a.showPage),t._showItems(a.showPage)})},bindOrder:function(){var t=this;"O"===t.options.$selectOrder.attr("id")&&t.options.$selectOrder.removeAttr("onchange").unbind("change").off("change"),t.options.$selectOrder.on("change",function(e){e.preventDefault();var s=$(this),i=s.val();t.options.$result.trigger("avantisearch.beforeChangeOrder",[t.options,t.request,s]),t._setUrlHash(1),t._changeOrder(i,function(){t.options.$result.trigger("avantisearch.afterChangeOrder",[t.options,t.request,s])})})},_changeOrder:function(t,e){this.request.query.O=t,this._concatRequest(),this._setUrlHash(1),this._loadFirst(e)},bindFilters:function(){var t=this;t.options.$filters.on("click",function(e){if("LABEL"===e.target.tagName)return!0;var s=$(this),i=s.find("input"),o=i.is(":checked"),a=i.attr("rel");o?s.addClass(t.options.classFilterActive):s.removeClass(t.options.classFilterActive),t.options.$result.trigger("avantisearch.beforeFilter",[t.options,t.request,s]),t._refreshFilter(a,o,s)})},_refreshFilter:function(t,e,s){var i=this,o=function(t){var s=t.split("="),o=s[0],a=s[1];if(e)i.request.query[o].push(a);else{var n=i.request.query[o].indexOf(a);i.request.query[o].splice(n,1)}};"object"==typeof t?t.map(o):"string"==typeof t&&o(t),i._loadFirst(function(){i.options.$result.trigger("avantisearch.afterFilter",[i.options,i.request,s||null]),i._setUrlHash(1),i.options.pagination&&(i._clearPagination(),i._createPagination()),i.bindPagination()})},bindPagination:function(){var t=this;$("."+t.options.classPagination).find("button").on("click",function(e){e.preventDefault();var s=$(this),i=parseInt(s.attr("page"));t.options.$result.trigger("avantisearch.beforeChangePage",[t.options,t.request]),t.load("html",i,function(){t._setUrlHash(i),t._showItems(i),t.request.query.PageNumber=i,t._clearPagination(),t._startPagination(),t._concatRequest(),t._saveCookie(),t.options.$result.trigger("avantisearch.afterChangePage",[t.options,t.request])})})},getDefaultOptions:function(){return{$resultItemsWrapper:$(".resultItemsWrapper"),$script:$(".resultItemsWrapper").children("script"),$totalItems:$(".searchResultsTime:first .resultado-busca-numero .value"),$selectOrder:$("#O"),$filters:$(".search-multiple-navigator label"),classFilterActive:"filter--active",classItemPreLoad:"shelf-item--preload",classLoadBtnHide:"load-btn--hide",classLoadLess:"load-less",classLoadMore:"load-more",classPagination:"pagination",textLoadLess:"Load less",textLoadMore:"Load more",textPaginationFirst:"First",textPaginationPrev:"Prev",textPaginationNext:"Next",textPaginationLast:"Last",textEmptyResult:"No product found",pagination:!1,paginationRangeButtons:3,cookieName:"AvantiSearchQuery",defaultParams:{},attempts:1}}},$.fn.avantiSearch=function(t){return AvantiSearch.init(this,t),this}}(jQuery);